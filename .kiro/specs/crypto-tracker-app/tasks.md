# 加密货币行情 App 实现计划

- [x] 1. 项目基础架构搭建

  - 创建 Android 项目基础结构，配置 Gradle 依赖和构建脚本
  - 设置 Hilt 依赖注入框架和基础模块配置
  - 配置 Compose 主题和 Material Design 3 样式系统，集成 Instagram 风格设计
  - 创建 InstagramColors 色彩系统和通用 UI 组件库
  - 创建项目包结构：data、domain、presentation、widget 模块
  - _需求: 6.1, 6.4_

- [ ] 2. 数据层核心接口和模型实现

  - [x] 2.1 创建数据模型和 API 响应实体

    - 实现 CoinMarketData、CoinDetails、PricePoint 等核心数据类
    - 创建 CoinGecko API 响应模型和 JSON 序列化配置
    - 实现数据验证器确保价格和百分比数据的有效性
    - _需求: 1.1, 1.2, 3.4, 5.5_

  - [x] 2.2 实现网络层和 API 接口

    - 使用 Retrofit 创建 CoinGecko API 接口定义
    - 实现 CryptoDataSource 接口和 CoinGeckoDataSource 具体实现
    - 配置 OkHttp 拦截器处理 API 限流和错误重试机制
    - 创建 NetworkResult 封装类处理网络请求结果
    - _需求: 1.3, 5.1, 5.4_

  - [x] 2.3 实现 Repository 模式和数据缓存
    - 创建 CryptoRepository 接口和具体实现类
    - 使用 DataStore 实现用户偏好设置存储（自选币种列表）
    - 实现 Room 数据库缓存机制，设置合理的缓存过期策略
    - 创建数据同步逻辑，协调网络数据和本地缓存
    - _需求: 2.3, 2.5, 5.2, 5.3_

- [ ] 3. 领域层业务逻辑实现

  - [x] 3.1 实现核心用例类

    - 创建 GetWatchlistUseCase 处理自选币种列表获取逻辑
    - 实现 AddCoinToWatchlistUseCase 和 RemoveCoinFromWatchlistUseCase
    - 创建 GetCoinDetailsUseCase 处理币种详情数据获取
    - 实现 SearchCoinsUseCase 支持币种搜索功能
    - _需求: 2.1, 2.2, 2.4, 3.1_

  - [x] 3.2 实现数据刷新和更新机制
    - 创建 RefreshMarketDataUseCase 处理定时数据更新
    - 实现 WebSocket 连接逻辑（如果 API 支持）作为实时数据源
    - 创建数据更新调度器，支持 1 分钟间隔的自动刷新
    - _需求: 1.3, 1.4_

- [ ] 4. UI 层基础组件实现

  - [x] 4.1 创建主界面和币种列表展示

    - 实现 WatchlistScreen 使用 LazyColumn 展示币种列表，采用 Instagram 风格卡片设计
    - 创建 CoinListItem 组件，使用圆角卡片、渐变色彩显示币种信息
    - 实现下拉刷新功能和 Instagram 风格的加载状态指示器
    - 添加简单的价格走势迷你图表，使用流畅的动画效果
    - 应用统一的 16dp 间距和 12dp 圆角设计规范
    - _需求: 1.1, 1.2, 6.2, 6.3_

  - [x] 4.2 实现 ViewModel 和状态管理
    - 创建 WatchlistViewModel 管理主界面状态和数据流
    - 实现 StateFlow 状态管理，处理加载、成功、错误状态
    - 创建 UI 状态数据类 WatchlistUiState 封装界面状态
    - 实现错误处理和用户友好的错误信息显示
    - _需求: 1.5, 6.6_

- [ ] 5. 自选币种管理功能实现

  - [x] 5.1 创建币种搜索界面

    - 实现 SearchScreen 支持币种名称和代码模糊搜索，使用 Instagram 风格搜索框
    - 创建搜索结果列表组件，采用圆角卡片展示主流币种和 SOL 生态 meme 币
    - 实现搜索防抖机制避免频繁 API 调用
    - 添加搜索历史和热门币种推荐功能，使用渐变背景突出显示
    - 集成流畅的搜索动画和状态转换效果
    - _需求: 2.1, 2.2_

  - [x] 5.2 实现自选列表管理逻辑
    - 创建添加/删除自选币种的 UI 交互组件
    - 实现自选币种的本地持久化存储和恢复
    - 添加自选列表的拖拽排序功能
    - 创建自选币种数据同步和实时更新机制
    - _需求: 2.3, 2.4, 2.5_

- [x] 6. K 线图详情页实现

  - [x] 6.1 创建币种详情页面结构

    - 实现 CoinDetailScreen 展示币种详细信息
    - 创建币种基本信息展示组件（价格、市值、成交量）
    - 实现页面导航和参数传递机制
    - 添加详情页的加载状态和错误处理
    - _需求: 3.1, 3.4_

  - [x] 6.2 集成 Vico 图表库实现 K 线图
    - 使用 Vico 创建专业的价格图表组件
    - 实现多时间周期切换（1 小时、24 小时、7 天、30 天）
    - 添加图表数据格式转换和渲染优化
    - 创建图表加载状态和错误处理
    - _需求: 3.2, 3.3, 3.5_

- [x] 7. 桌面 Widget 核心功能实现

  - [x] 7.1 创建 Glance Widget 基础结构

    - 使用 Glance 框架创建 CryptoWidget 类
    - 实现 Widget 的基本布局和样式配置
    - 创建 Widget 配置 Activity 支持用户自定义显示内容
    - 实现 Widget 的安装和卸载处理逻辑
    - _需求: 4.1, 4.5_

  - [x] 7.2 实现 Widget 数据更新机制
    - 创建 Widget 数据提供者，从 Repository 获取最新行情数据
    - 实现 WorkManager 定时任务，每 1 分钟更新 Widget 内容
    - 添加 Widget 点击事件处理，跳转到对应币种详情页
    - 实现网络异常时的缓存数据显示和状态提示
    - _需求: 4.2, 4.3, 4.4, 4.6_

- [x] 8. 用户体验优化和主题适配

  - [x] 8.1 实现 Instagram 风格主题和暗黑模式

    - 创建 Instagram 风格的 Material Design 3 主题配置，集成渐变色彩系统
    - 实现暗黑模式自动检测和手动切换功能，保持 Instagram 美学
    - 优化所有 UI 组件在不同主题下的显示效果，确保圆角和阴影一致性
    - 创建主题切换的平滑动画过渡效果
    - 确保 Widget 在不同主题下保持 Instagram 风格的一致性显示
    - _需求: 6.4_

  - [x] 8.2 添加 Instagram 风格用户引导和交互反馈
    - 实现首次使用的简单引导流程，使用 Instagram 风格的渐变按钮和卡片
    - 添加适当的触觉反馈和流畅的动画效果，模仿 Instagram 的交互体验
    - 创建 Instagram 风格的加载状态骨架屏和渐变进度指示器
    - 实现用户操作的圆角确认对话框和优雅的提示信息
    - 集成页面转场动画，提供类似 Instagram 的流畅导航体验
    - _需求: 6.1, 6.5_

- [x] 9. 错误处理和数据验证完善

  - [x] 9.1 完善网络错误处理机制

    - 实现网络连接状态检测和用户提示
    - 创建 API 错误码映射和用户友好错误信息
    - 添加请求重试机制和指数退避策略
    - 实现离线状态下的用户体验优化
    - _需求: 1.5, 5.4, 6.6_

  - [x] 9.2 实现数据完整性验证
    - 创建价格数据异常检测和过滤机制
    - 实现 API 响应数据的格式验证和容错处理
    - 添加数据更新失败时的降级策略
    - 创建应用崩溃恢复和状态保存机制
    - _需求: 5.5_

- [x] 10. 性能优化和测试完善

  - [x] 10.1 实现性能优化策略

    - 优化列表滚动性能，实现图片懒加载和内存管理
    - 创建网络请求去重机制，避免重复 API 调用
    - 实现数据预加载和智能缓存策略
    - 优化 Widget 更新频率，平衡实时性和电池消耗
    - _需求: 1.3, 4.3_

  - [x] 10.2 编写单元测试和集成测试
    - 为 Repository 层编写单元测试，使用 MockWebServer 模拟 API
    - 创建 ViewModel 测试，验证状态管理和业务逻辑正确性
    - 实现 Compose UI 测试，验证用户交互和界面显示
    - 编写 Widget 功能测试，确保桌面组件正常工作
    - _需求: 所有需求的质量保证_

- [x] 11. 最终集成和发布准备

  - [x] 11.1 应用整体集成和调优

    - 集成所有功能模块，确保数据流和导航的一致性
    - 进行端到端测试，验证完整的用户使用流程
    - 优化应用启动时间和内存使用
    - 创建应用图标和启动画面
    - _需求: 所有需求的最终验证_

  - [x] 11.2 构建配置和安全加固
    - 配置 ProGuard 代码混淆和资源压缩
    - 实现 API 密钥的安全存储和访问控制
    - 创建不同构建变体（debug、release）的配置
    - 准备应用签名和发布配置
    - _需求: 5.3, 安全性要求_
